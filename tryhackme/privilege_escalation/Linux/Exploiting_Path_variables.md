## What is PATH?
- PATH is an environmental variable in Linux and Unix-like operating systems which specifies directories that hold executable programs.
- When the user runs any command in the terminal, it searches for executable files with the help of the PATH Variable in response to commands executed by a user.
- It is very simple to view the Path of the relevant user with help of the command **"echo $PATH"**.

## How does this let us escalate privileges?
Let's say we have an SUID binary. Running it, we can see that it’s calling the system shell to do a basic process like list processes with "ps". Unlike in our previous SUID example, in this situation we can't exploit it by supplying an argument for command injection, so what can we do to try and exploit this?

We can re-write the PATH variable to a location of our choosing! So when the SUID binary calls the system shell to run an executable, it runs one that we've written instead!

As with any SUID file, it will run this command with the same privileges as the owner of the SUID file! If this is root, using this method we can run whatever commands we like as root!

## Practically - 
1. First locate any file that have SUID bit set.
```python
root@polobox:~# /bin/ls -l
total 44
drwxr-xr-x 2 user5 user5 4096 Jun  4  2019 Desktop
drwxr-xr-x 2 user5 user5 4096 Jun  4  2019 Documents
drwxr-xr-x 2 user5 user5 4096 Jun  4  2019 Downloads
drwxr-xr-x 2 user5 user5 4096 Jun  4  2019 Music
drwxr-xr-x 2 user5 user5 4096 Jun  4  2019 Pictures
drwxr-xr-x 2 user5 user5 4096 Jun  4  2019 Public
-rwsr-xr-x 1 root  root  8392 Jun  4  2019 script
drwxr-xr-x 2 user5 user5 4096 Jun  4  2019 Templates
drwxr-xr-x 2 user5 user5 4096 Jun  4  2019 Videos
```

```python
user5@polobox:~$ ./script 
Desktop  Documents  Downloads  Music  Pictures	Public	script	Templates  Videos
```
It definitely looks like the script is listing our files and directories, so this points us to the command **_ls_**.

Unlike in our previous SUID example, in this situation we can't exploit it by supplying an argument for command injection, so what can we do to try and exploit this?

We can re-write the PATH variable to a location of our choosing! So when the SUID binary calls the system shell to run an executable, it runs one that we've written instead!

2. Now, change directory to `/tmp`.
```python
user5@polobox:~$ cd /tmp
```

3. **Now we’re inside tmp, let’s create an imitation executable. The format for what we want to do is: echo “[whatever command we want to run]” > [name of the executable we’re imitating]. What would the command look like to open a bash shell, writing to a file with the name of the executable we’re imitating**
We need to replace the ls executable with the command to open a bash shell. We do this by echoing the path of the bash shell to a file called ls.
```python
user5@polobox:/tmp$ echo "/bin/bash" > ls
```

4. **Great! Now we’ve made our imitation, we need to make it an executable.**
![[linux_privesc11.png]]

5. **Now, we need to change the PATH variable, so that it points to the directory where we have our imitation “ls” stored! We do this using the command “export PATH=/tmp:$PATH”**
**Note, this will cause you to open a bash prompt every time you use “ls”. If you need to use “ls” before you finish the exploit, use “/bin/ls” where the real “ls” executable is.**

6. **Now, change directory back to user5’s home directory.**
```python
cd /home/user5
```

7. **Now, run the “script” file again, you should be sent into a root bash prompt!**
![[linux_privesc10.webp]]